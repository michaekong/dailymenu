<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu Restaurant - Interface Client</title>
    <style>
        :root {
            --rouge-brique: #8B2323;
            --rouge-doux: #A24E4E;
            --rouge-fonce: #5A0A0A;
            --rose-pale: #E7D3D3;
            --jaune-creme: #FFF1CF;
            --bleu-clair: #CCE5FF;
            --noir-doux: #2C1A1A;
            --glass-bg: rgba(44, 26, 26, 0.85);
            --glass-light: rgba(231, 211, 211, 0.2);
            --glow-shadow: 0 0 25px rgba(162, 78, 78, 0.8);

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--rose-pale), #F5E6E6, #FADEDE);
            min-height: 100vh;
            overflow-x: hidden;
            color: var(--noir-doux);
        }

        /* Animations de fond */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 20%, rgba(139, 35, 35, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(162, 78, 78, 0.08) 0%, transparent 50%);
            animation: dance 8s ease-in-out infinite;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes dance {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(2deg); }
            50% { transform: scale(1.05) rotate(-1deg); }
            75% { transform: scale(1.15) rotate(1deg); }
        }

        /* Particules flottantes */
        .particle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: var(--rouge-brique);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
            opacity: 0.6;
            box-shadow: 0 0 10px var(--rouge-brique);
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        /* Container principal */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        /* Header avec glassmorphisme */
        .header {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--glow-shadow), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(162, 78, 78, 0.3);
            animation: slideDown 0.8s ease-out;
        }

        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .header h1 {
            color: var(--rose-pale);
            font-size: 2.5rem;
            text-align: center;
            margin-bottom: 10px;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.5);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .header p {
            text-align: center;
            color: var(--rose-pale);
            font-size: 1.1rem;
            font-weight: 500;
            opacity: 0.9;
        }

        /* Section QR Code */
        .qr-section {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: var(--glow-shadow), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(162, 78, 78, 0.3);
            animation: slideLeft 0.8s ease-out 0.2s both;
        }

        @keyframes slideLeft {
            from { transform: translateX(-50px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .qr-code {
            width: 150px;
            height: 150px;
            background: var(--jaune-creme);
            border-radius: 15px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            animation: rotate 4s linear infinite;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Barre de recherche */
        .search-container {
            position: relative;
            margin-bottom: 30px;
            animation: slideRight 0.8s ease-out 0.4s both;
        }

        @keyframes slideRight {
            from { transform: translateX(50px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .search-bar {
            width: 100%;
            padding: 15px 50px 15px 20px;
            border: none;
            border-radius: 25px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            font-size: 1.1rem;
            color: var(--rose-pale);
            box-shadow: var(--glow-shadow), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(162, 78, 78, 0.3);
            transition: all 0.3s ease;
        }

        .search-bar::placeholder {
            color: rgba(231, 211, 211, 0.7);
        }

        .search-bar:focus {
            outline: none;
            transform: scale(1.02);
            box-shadow: 0 0 30px rgba(162, 78, 78, 0.8);
        }

        .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--rose-pale);
            font-size: 1.2rem;
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(-50%); }
            50% { transform: translateY(-60%); }
        }

        /* Filtres */
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
            animation: fadeInUp 0.8s ease-out 0.6s both;
        }

        @keyframes fadeInUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .filter-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 20px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            color: var(--rose-pale);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(162, 78, 78, 0.3);
        }

        .filter-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: var(--glow-shadow);
            background: var(--rouge-doux);
            color: white;
        }

        .filter-btn.active {
            background: var(--rouge-brique);
            color: white;
            transform: scale(1.1);
        }

        /* Grille des plats */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .dish-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 20px;
            box-shadow: var(--glow-shadow), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(162, 78, 78, 0.3);
            transition: all 0.3s ease;
            animation: scaleIn 0.8s ease-out;
        }

        @keyframes scaleIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .dish-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 0 40px rgba(162, 78, 78, 0.8);
        }

        .dish-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(45deg, var(--jaune-creme), var(--bleu-clair));
            border-radius: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            cursor: pointer;
            transition: all 0.3s ease;
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .dish-image:hover {
            transform: scale(1.1);
            border-radius: 10px;
        }

        .dish-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--rose-pale);
            margin-bottom: 10px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }

        .dish-description {
            color: rgba(231, 211, 211, 0.8);
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .dish-price {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--rose-pale);
            margin-bottom: 15px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }

        /* Syst√®me d'avis */
        .rating-section {
            border-top: 1px solid rgba(231, 211, 211, 0.3);
            padding-top: 15px;
        }

        .stars {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }

        .star {
            color: #FFD700;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s ease;
            animation: twinkle 2s ease-in-out infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .star:hover {
            transform: scale(1.3);
            text-shadow: 0 0 10px #FFD700;
        }

        .comment-box {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 10px;
            background: rgba(231, 211, 211, 0.2);
            backdrop-filter: blur(10px);
            margin-top: 10px;
            resize: vertical;
            min-height: 60px;
            color: var(--rose-pale);
            border: 1px solid rgba(162, 78, 78, 0.2);
        }

        .comment-box::placeholder {
            color: rgba(231, 211, 211, 0.6);
        }

        /* Indicateurs de chargement */
        .loading {
            text-align: center;
            padding: 50px;
            color: var(--noir-doux);
            font-size: 1.2rem;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(231, 211, 211, 0.3);
            border-top: 4px solid var(--rouge-brique);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Mode hors-ligne */
        .offline-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            color: var(--rose-pale);
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.9rem;
            z-index: 1000;
            animation: slideInRight 0.5s ease-out;
            border: 1px solid rgba(162, 78, 78, 0.3);
            box-shadow: var(--glow-shadow);
        }

        @keyframes slideInRight {
            from { transform: translateX(100px); }
            to { transform: translateX(0); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .menu-grid {
                grid-template-columns: 1fr;
            }

            .filters {
                gap: 10px;
            }

            .filter-btn {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
        }
        .etablissement-section {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border-radius: 20px;
    padding: 20px;
    margin-bottom: 30px;
    text-align: center;
    box-shadow: var(--glow-shadow), inset 0 1px 0 rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(162, 78, 78, 0.3);
    animation: slideLeft 0.8s ease-out 0.2s both;
}
.etablissement-section h3 {
    color: var(--rose-pale);
    font-size: 1.8rem;
    margin-bottom: 10px;
}
.etablissement-section p {
    color: rgba(231, 211, 211, 0.8);
    font-size: 1rem;
}
    </style>
</head>
<body>
    <!-- Particules anim√©es -->
    <div class="particle" style="top: 10%; left: 20%; animation-delay: 0s;"></div>
    <div class="particle" style="top: 30%; left: 80%; animation-delay: 1s;"></div>
    <div class="particle" style="top: 60%; left: 10%; animation-delay: 2s;"></div>
    <div class="particle" style="top: 80%; left: 70%; animation-delay: 3s;"></div>

    <!-- Indicateur hors-ligne -->
    <div class="offline-indicator" id="offlineIndicator" style="display: none;">
        üì± Mode hors-ligne activ√©
    </div>

    <div class="container">
        <!-- En-t√™te -->
        <header class="header">
            <h1>üçΩÔ∏è Menu Restaurant</h1>
            <p>Interface Client Responsive - Th√®me Dance</p>
        </header>

        <!-- Section QR Code -->
        <section class="qr-section">
            <div class="qr-code">üì±</div>
            <h3>Scannez le QR Code pour acc√©der au menu</h3>
            <p>Interface responsive ‚Ä¢ Chargement rapide < 3 secondes</p>
        </section>

        <!-- Barre de recherche -->
        <div class="search-container">
            <input type="text" class="search-bar" placeholder="Recherchez un plat, ingr√©dient..." id="searchInput">
            <span class="search-icon">üîç</span>
        </div>

        <!-- Filtres -->
        <div class="filters">
            <button class="filter-btn active" data-filter="all">Tous</button>
            <button class="filter-btn" data-filter="entrees">Entr√©es</button>
            <button class="filter-btn" data-filter="plats">Plats</button>
            <button class="filter-btn" data-filter="desserts">Desserts</button>
            <button class="filter-btn" data-filter="sans-gluten">Sans Gluten</button>
            <button class="filter-btn" data-filter="vegetarien">V√©g√©tarien</button>
        </div>

        <!-- Chargement -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            Chargement du menu...
        </div>

        <!-- Grille des plats (sera remplie dynamiquement) -->
        <div class="menu-grid" id="menuGrid" style="display: none;">
            <!-- Les plats seront charg√©s dynamiquement depuis l'API -->
        </div>
    </div>

    <script>
       // Configuration API
//const API_BASE_URL = 'http://127.0.0.1:8000'; // Corrig√© pour supprimer le double "/api"
/const API_BASE_URL ="https://dailymenu.onrender.com/";
// Extraire menu_id depuis l'URL
const getMenuIdFromUrl = () => {
    const path = window.location.pathname;
    const match = path.match(/\/menus\/([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})/i);
    return match ? match[1] : 'eb95505e-6bc2-439f-be3c-1d8e7f7df721'; // Valeur par d√©faut
};
const MENU_ID = getMenuIdFromUrl();

// Variables globales
let menuData = null;
let allItems = [];
let categories = [];
let allergenes = [];

// Fonction pour retenter la requ√™te API
async function fetchWithRetry(url, retries = 3, delay = 1000) {
    for (let attempt = 1; attempt <= retries; attempt++) {
        try {
            const response = await fetch(url);
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            return await response.json();
        } catch (error) {
            if (attempt === retries) throw error;
            await new Promise(resolve => setTimeout(resolve, delay * attempt));
        }
    }
}

// Chargement des donn√©es depuis l'API
async function loadMenuData() {
    const loading = document.getElementById('loading');
    const menuGrid = document.getElementById('menuGrid');
    try {
        const data = await fetchWithRetry(`${API_BASE_URL}/api/api/public/menu/${MENU_ID}`);
        menuData = data.menu || {};
        allItems = data.menu.items || [];
        categories = data.categories || [];
        allergenes = data.allergenes || [];
        const etablissement = data.etablissement || {};
        const qrcodeUrl = data.qrcode;

        // Stocker dans localStorage pour mode hors-ligne
        localStorage.setItem('menuCache', JSON.stringify(data));

        // Mise √† jour de l'interface
        updateMenuTitle();
        updateEtablissementInfo(etablissement);
        updateQRCode(qrcodeUrl);
        generateCategoryFilters();
        displayMenuItems(allItems);

        // Masquer le chargement et afficher le menu
        loading.style.display = 'none';
        menuGrid.style.display = 'grid';
    } catch (error) {
        console.error('Erreur:', error);
        // Essayer de charger depuis le cache
        const cachedData = localStorage.getItem('menuCache');
        if (cachedData) {
            const data = JSON.parse(cachedData);
            menuData = data.menu || {};
            allItems = data.menu.items || [];
            categories = data.categories || [];
            allergenes = data.allergenes || [];
            updateMenuTitle();
            generateCategoryFilters();
            displayMenuItems(allItems);
            loading.style.display = 'none';
            menuGrid.style.display = 'grid';
            document.getElementById('offlineIndicator').style.display = 'block';
        } else {
            loading.innerHTML = `
                <div style="color: var(--rouge-brique);">
                    ‚ùå Erreur de chargement du menu<br>
                    <small>V√©rifiez votre connexion ou r√©essayez plus tard</small>
                </div>
            `;
        }
    }
}

// Mise √† jour du titre du menu
function updateMenuTitle() {
    if (menuData) {
        document.querySelector('.header h1').textContent = `üçΩÔ∏è ${menuData.nom || 'Menu Restaurant'}`;
        document.querySelector('.header p').textContent = menuData.description || 'Menu du restaurant - Interface responsive';
    }
}
// Nouvelle fonction pour mettre √† jour les infos de l'√©tablissement
function updateEtablissementInfo(etablissement) {
    const etablissementSection = document.createElement('section');
    etablissementSection.className = 'etablissement-section';
    etablissementSection.innerHTML = `
        <h3>${etablissement.nom_etablissement || 'Restaurant'}</h3>
        <p>üìç ${etablissement.adresse_physique || 'Adresse non disponible'}</p>
        <p>üìû ${etablissement.numtel || 'Num√©ro non disponible'}</p>
        <p>üìß ${etablissement.email_pro || 'Email non disponible'}</p>
    `;
    document.querySelector('.container').insertBefore(etablissementSection, document.querySelector('.qr-section'));
}

// Nouvelle fonction pour mettre √† jour le QR code
function updateQRCode(qrcodeUrl) {
    const qrCodeDiv = document.querySelector('.qr-code');
    if (qrcodeUrl) {
        qrCodeDiv.innerHTML = `<img src="${qrcodeUrl}" alt="QR Code" style="width: 100%; height: 100%; border-radius: 15px;">`;
    } else {
        qrCodeDiv.innerHTML = 'üì± Aucun QR code disponible';
    }
}

// G√©n√©ration dynamique des filtres de cat√©gories
function generateCategoryFilters() {
    const filtersContainer = document.querySelector('.filters');
    const allButton = filtersContainer.querySelector('[data-filter="all"]');
    filtersContainer.innerHTML = '';
    filtersContainer.appendChild(allButton);

    // Ajouter les cat√©gories depuis l'API
    const uniqueCategories = [...new Set(categories.map(cat => cat.name))];
    uniqueCategories.forEach(categoryName => {
        const button = document.createElement('button');
        button.className = 'filter-btn';
        button.dataset.filter = categoryName.toLowerCase();
        button.textContent = categoryName.charAt(0).toUpperCase() + categoryName.slice(1);
        filtersContainer.appendChild(button);
    });

    // Ajouter les filtres allerg√®nes
    allergenes.forEach(allergene => {
        const button = document.createElement('button');
        button.className = 'filter-btn allergene-filter';
        button.dataset.filter = `allergene-${allergene.nom_allergene.toLowerCase()}`;
        button.textContent = `Sans ${allergene.nom_allergene}`;
        button.style.background = 'var(--rouge-doux)';
        filtersContainer.appendChild(button);
    });

    // R√©attacher les √©v√©nements
    attachFilterEvents();
}

// Affichage des √©l√©ments du menu
function displayMenuItems(items) {
    const menuGrid = document.getElementById('menuGrid');
    menuGrid.innerHTML = '';
    items.forEach(item => {
        const dishCard = createDishCard(item);
        menuGrid.appendChild(dishCard);
    });
}

// Cr√©ation d'une carte de plat
function createDishCard(item) {
    const card = document.createElement('div');
    card.className = 'dish-card';
    card.dataset.category = (item.categories || []).map(cat => cat.name.toLowerCase()).join(' ');
    card.dataset.allergenes = (item.ingredients || []).flatMap(ing => (ing.allergenes || []).map(a => a.nom_allergene.toLowerCase())).join(' ');

    // Gestion de l'image
    const imageUrl = item.images && item.images.length > 0 ? `${API_BASE_URL}${item.images[0].url_image}` : null;

    // Disponibilit√©
    const availabilityText = item.disponibilite ? '‚úÖ Disponible' : '‚ùå Indisponible';
    const availabilityColor = item.disponibilite ? 'var(--rose-pale)' : 'var(--rouge-doux)';

    // Jours de disponibilit√©
    const joursDisponibilite = (item.jours_disponibilite || []).map(jour => jour.nom).join(', ');

    // Tags
    const tags = (item.tags || []).map(tag => tag.name).join(', ');

    // Ingr√©dients
    const ingredients = (item.ingredients || []).map(ing => ing.nom_ingredient).join(', ');

    // Validation des donn√©es
    const price = item.price ? parseFloat(item.price).toFixed(0) : 'N/A';
    const prepTime = item.prep_time || 'N/A';
    const description = item.description || 'Aucune description disponible';
    const nomPlat = item.nom_plat || 'Plat sans nom';

    card.innerHTML = `
        <div class="dish-image" onclick="zoomImage(this)" style="background-image: ${imageUrl ? `url('${imageUrl}')` : 'none'}; background-size: cover; background-position: center;">
            ${!imageUrl ? 'üçΩÔ∏è' : ''}
        </div>
        <h3 class="dish-title">${nomPlat}</h3>
        <p class="dish-description">${description}</p>
        <div class="dish-info">
            <div class="dish-price">${price} FCFA</div>
            <div style="color: ${availabilityColor}; font-size: 0.9rem; margin-bottom: 5px;">${availabilityText}</div>
            <div style="color: rgba(231, 211, 211, 0.7); font-size: 0.8rem; margin-bottom: 5px;">
                ‚è±Ô∏è ${prepTime} min
            </div>
            ${joursDisponibilite ? `<div style="color: rgba(231, 211, 211, 0.7); font-size: 0.8rem; margin-bottom: 5px;">üìÖ ${joursDisponibilite}</div>` : ''}
            ${tags ? `<div style="color: rgba(231, 211, 211, 0.6); font-size: 0.8rem; margin-bottom: 5px;">üè∑Ô∏è ${tags}</div>` : ''}
            ${ingredients ? `<div style="color: rgba(231, 211, 211, 0.6); font-size: 0.8rem; margin-bottom: 10px;">ü•¨ ${ingredients}</div>` : ''}
        </div>
        <div class="rating-section">
            <div class="stars" data-item-id="${item.id_item || nomPlat}">
                <span class="star">‚≠ê</span>
                <span class="star">‚≠ê</span>
                <span class="star">‚≠ê</span>
                <span class="star">‚≠ê</span>
                <span class="star">‚òÜ</span>
            </div>
            <textarea class="comment-box" placeholder="Laissez un commentaire sur ${nomPlat}..."></textarea>
            <button class="submit-comment" style="margin-top: 10px; padding: 8px; border-radius: 10px; background: var(--rouge-brique); color: var(--rose-pale); border: none; cursor: pointer;">Soumettre</button>
        </div>
    `;
    return card;
}

// Attachement des √©v√©nements de filtrage
function attachFilterEvents() {
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            const filter = this.dataset.filter;
            filterItems(filter);
        });
    });
}

// Fonction de filtrage
function filterItems(filter) {
    alert(filter)
    const dishes = document.querySelectorAll('.dish-card');
    dishes.forEach(dish => {
        let shouldShow = false;
        if (filter === 'all') {
            shouldShow = true;
        } else if (filter.startsWith('allergene-')) {
            const allergene = filter.split('-')[1].toLowerCase();
            const dishAllergenes = dish.dataset.allergenes.split(' ').filter(a => a);
            shouldShow = !dishAllergenes.includes(allergene); // Exclure les plats avec cet allerg√®ne
        } else {
            shouldShow = dish.dataset.category.includes(filter);
        }
        dish.style.display = shouldShow ? 'block' : 'none';
        if (shouldShow) dish.style.animation = 'scaleIn 0.5s ease-out';
    });
}

// Recherche am√©lior√©e
function setupSearch() {
    document.getElementById('searchInput').addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        const dishes = document.querySelectorAll('.dish-card');
        dishes.forEach(dish => {
            const title = dish.querySelector('.dish-title').textContent.toLowerCase();
            const description = dish.querySelector('.dish-description').textContent.toLowerCase();
            const ingredients = dish.querySelector('.dish-info').textContent.toLowerCase();
            if (title.includes(searchTerm) || description.includes(searchTerm) || ingredients.includes(searchTerm)) {
                dish.style.display = 'block';
            } else {
                dish.style.display = 'none';
            }
        });
    });
}

// Zoom sur les images
function zoomImage(element) {
    element.style.transform = 'scale(1.5)';
    element.style.zIndex = '1000';
    element.style.position = 'relative';
    setTimeout(() => {
        element.style.transform = '';
        element.style.zIndex = '';
        element.style.position = '';
    }, 2000);
}

// Syst√®me de notation et commentaires
function setupRating() {
    let reviews = JSON.parse(localStorage.getItem('reviews')) || [];
    document.querySelectorAll('.dish-card').forEach(card => {
        const starsContainer = card.querySelector('.stars');
        const itemId = starsContainer.dataset.itemId;
        const stars = starsContainer.querySelectorAll('.star');
        const commentBox = card.querySelector('.comment-box');
        const submitBtn = card.querySelector('.submit-comment');

        stars.forEach((star, index) => {
            star.addEventListener('click', function() {
                stars.forEach((s, i) => {
                    s.textContent = i <= index ? '‚≠ê' : '‚òÜ';
                    s.style.animation = 'twinkle 0.5s ease-in-out';
                });
            });
        });

        submitBtn.addEventListener('click', () => {
            const rating = starsContainer.querySelectorAll('.star').length - starsContainer.querySelectorAll('.star').length;
            const comment = commentBox.value.trim();
            if (rating === 0 && !comment) {
                alert('Veuillez donner une note ou un commentaire.');
                return;
            }

            // V√©rifier si l'utilisateur a d√©j√† not√© r√©cemment
            const lastReview = reviews.find(r => r.itemId === itemId);
            const now = new Date();
            const canReview = !lastReview || (now - new Date(lastReview.timestamp)) > 15 * 24 * 60 * 60 * 1000;

            if (!canReview) {
                alert('Vous avez d√©j√† laiss√© un avis r√©cemment. Veuillez attendre 15 jours.');
                return;
            }

            // Sauvegarder l'avis
            reviews.push({
                itemId,
                rating,
                comment,
                timestamp: now.toISOString()
            });
            localStorage.setItem('reviews', JSON.stringify(reviews));
            alert(`Merci pour votre note de ${rating} √©toile(s) et votre commentaire !`);
            commentBox.value = '';
            stars.forEach(s => s.textContent = '‚òÜ');
        });
    });
}

// D√©tection du r√©seau
function setupNetworkDetection() {
    const offlineIndicator = document.getElementById('offlineIndicator');
    window.addEventListener('online', () => {
        offlineIndicator.style.display = 'none';
        loadMenuData(); // Recharger les donn√©es fra√Æches
    });
    window.addEventListener('offline', () => {
        offlineIndicator.style.display = 'block';
    });
}

// Initialisation
document.addEventListener('DOMContentLoaded', function() {
    loadMenuData();
    setupSearch();
    setupRating();
    setupNetworkDetection();
});
    </script>
</body>
</html>